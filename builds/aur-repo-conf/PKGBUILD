# Maintainer: Carles Rafols i Belles

pkgname=aur-repo-conf
pkgver=1
pkgrel=1
pkgdesc="Install pacman configuration (pacman.conf) for Arch User Repository"
arch=(any)
license=(GPL)
source=(aur.conf aur.sh)
install=pacman-conf.install
depends=(include-pacman-conf)

package() {
  # Add pacman configuration file
  # The file will be included in /etc/pacman.conf via the Include command
  install -Dm0644 "$srcdir/aur.conf" "$pkgdir/etc/pacman.d/aur.conf"

  # Add aurutils environment variables to /etc/profile.d/
  install -Dm0644 "$srcdir/aur.sh" "$pkgdir/etc/profile.d/aur.sh"

  # Copy the aurutils package to the local repo directory
  # Give read/write permisions to the "wheel" group
  install -Dm0664 --group="wheel" \
    "$srcdir/aurutils-3.1.2-2-any.pkg.tar.zst" \
    "$pkgdir/var/cache/pacman/aur-pkg/aurutils-3.1.2-2-any.pkg.tar.zst"

  # Create database and add the aurutils package
  repo-add \
    "$pkgdir/var/cache/pacman/aur-pkg/aur.db.tar.gz" \
    "$pkgdir/var/cache/pacman/aur-pkg/aurutils-3.1.2-2-any.pkg.tar.zst"

  # Grant read/write access of the whole directory to the "wheel" group
  chgrp -Rh "wheel" "$pkgdir/var/cache/pacman/aur-pkg"
  chmod -R 774 "$pkgdir/var/cache/pacman/aur-pkg"

  # aurutils uses an independent pacman.conf for its builds
  install -vDm0644 \
    "$srcdir/pacman-aur.conf" \
    "$pkgdir/etc/aurutils/pacman-aur.conf"
}
sha256sums=('78b7c81385ec3802bf5247b2eeb6cbca9cf25133deb1f7e07000ba18e7b2dcdc'
            '5420f6746c1d291ecdb383e5bc4c4c67321c3546cb455038d39d812416a87d50')
